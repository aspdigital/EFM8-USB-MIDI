C51 COMPILER V9.53.0.0   JOYBUTTON                                                         04/17/2019 17:13:50 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE JOYBUTTON
OBJECT MODULE PLACED IN .\src\joybutton.OBJ
COMPILER INVOKED BY: c:\SiliconLabs\SimplicityStudio\v4\developer\toolchains\keil_8051\9.53\BIN\C51.exe C:\Users\apeters
                    -.SPECSERV\Projects\EFM8-USB-MIDI\src\joybutton.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATFUZZY(3) 
                    -OPTIMIZE(8,SPEED) DEFINE(DEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(C:\Users\apeters.SPECSERV\Projects\EFM8-USB-MIDI\i
                    -nc;C:\Users\apeters.SPECSERV\Projects\EFM8-USB-MIDI\inc\config;C:\Users\apeters.SPECSERV\Projects\EFM8-USB-MIDI\usb_audi
                    -o\inc;${workspace_loc:/;${workspace_loc:/;C:\Users\apeters.SPECSERV\Projects\EFM8-USB-MIDI\lib\bsp\efm8_memory_lcd\inc;C
                    -:\Users\apeters.SPECSERV\Projects\EFM8-USB-MIDI\lib\bsp\efm8_memory_lcd\inc\config;${workspace_loc:/;${workspace_loc:/C:
                    -\Users\apeters.SPECSERV\Projects\EFM8-USB-MIDI\lib\bsp\efm8_joystick;${workspace_loc:/C:\Users\apeters.SPECSERV\Projects
                    -\EFM8-USB-MIDI\lib\bsp\efm8_rgb_led;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.1.6//Device/shared/si8051B
                    -ase;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.1.6//Device/EFM8UB2/inc;C:/SiliconLabs/SimplicityStudio/v4
                    -/developer/sdks/8051/v4.1.6//Lib/efm8_usb/inc;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.1.6//Lib/efm8_as
                    -sert;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.1.6//kits/common/drivers/efm8_joystick;C:/SiliconLabs/Sim
                    -plicityStudio/v4/developer/sdks/8051/v4.1.6//kits/common/drivers/efm8_memory_lcd/inc;C:/SiliconLabs/SimplicityStudio/v4/
                    -developer/sdks/8051/v4.1.6//kits/common/drivers/efm8_memory_lcd/inc/graphics;C:/SiliconLabs/SimplicityStudio/v4/develope
                    -r/sdks/8051/v4.1.6//kits/common/drivers/efm8_memory_lcd/inc/config;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/805
                    -1/v4.1.6//kits/common/bsp;C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.1.6//kits/EFM8UB2_SLSTK2001A/config;
                    -C:/SiliconLabs/SimplicityStudio/v4/developer/sdks/8051/v4.1.6//kits/common/drivers/efm8_rgb_led;C:/SiliconLabs/Simplicit
                    -yStudio/v4/developer/sdks/8051/v4.1.6//Device/EFM8UB2/peripheral_driver/inc) PRINT(.\src\joybutton.lst) COND PAGEWIDTH(1
                    -20) PAGELENGTH(65) OA OBJECT(.\src\joybutton.OBJ)

line level    source

   1          /**************************************************************************//**
   2           * Copyright (c) 2015 by Silicon Laboratories Inc. All rights reserved.
   3           *
   4           * http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
   5           *****************************************************************************/
   6          /////////////////////////////////////////////////////////////////////////////
   7          // button.c
   8          /////////////////////////////////////////////////////////////////////////////
   9          
  10          /////////////////////////////////////////////////////////////////////////////
  11          // Includes
  12          /////////////////////////////////////////////////////////////////////////////
  13          
  14          #include "bsp.h"
  15          //#include "retargetserial.h"
  16          #include "joybutton.h"
  17          #include "joystick.h"
  18          #include <string.h>
  19          
  20          //-----------------------------------------------------------------------------
  21          // Constants
  22          //-----------------------------------------------------------------------------
  23          
  24          //-----------------------------------------------------------------------------
  25          // Functions
  26          //-----------------------------------------------------------------------------
  27          
  28          //-----------------------------------------------------------------------------
  29          // Joystick_GetStatus() Routine
  30          // ----------------------------------------------------------------------------
  31          //
  32          // Description - Get joystick status.
  33          //
  34          // Return - Which direction on the joystick has been pushed as well as which
  35          //          buttons have been pressed
  36          //-----------------------------------------------------------------------------
  37          uint8_t Joystick_GetStatus(void)
  38          {
  39   1        uint8_t joyStatus = 0;
C51 COMPILER V9.53.0.0   JOYBUTTON                                                         04/17/2019 17:13:50 PAGE 2   

  40   1        uint8_t joystickDirection;
  41   1        uint16_t sample;
  42   1        uint32_t mv;
  43   1      
  44   1        // Manually initiate an ADC conversion
  45   1        ADC0CN0_ADBUSY = 1;
  46   1        // Wait for conversion to complete
  47   1        while (ADC0CN0_ADBUSY);
  48   1      
  49   1        sample = ADC0;
  50   1        mv = ((uint32_t)sample) * 3300 / 1024;
  51   1      
  52   1        joystickDirection = JOYSTICK_convert_mv_to_direction(mv);
  53   1      
  54   1              switch (joystickDirection)
  55   1              {
  56   2              case JOYSTICK_N:    joyStatus |= JOY_UP;                break;
  57   2              case JOYSTICK_NE:   joyStatus |= JOY_UP | JOY_RIGHT;    break;
  58   2              case JOYSTICK_E:    joyStatus |= JOY_RIGHT;             break;
  59   2              case JOYSTICK_SE:   joyStatus |= JOY_DOWN | JOY_RIGHT;  break;
  60   2              case JOYSTICK_S:    joyStatus |= JOY_DOWN;              break;
  61   2              case JOYSTICK_SW:   joyStatus |= JOY_DOWN | JOY_LEFT;   break;
  62   2              case JOYSTICK_W:    joyStatus |= JOY_LEFT;              break;
  63   2              case JOYSTICK_NW:   joyStatus |= JOY_UP | JOY_LEFT;     break;
  64   2              }
  65   1      
  66   1          if (!LEFT_BUTTON_PIN)
  67   1          {
  68   2              joyStatus |= LEFT_BUTTON;
  69   2          }
  70   1          if (!RIGHT_BUTTON_PIN)
  71   1          {
  72   2              joyStatus |= RIGHT_BUTTON;
  73   2          }
  74   1          if (joystickDirection == JOYSTICK_C)
  75   1          {
  76   2              joyStatus |= CENTER_BUTTON;
  77   2          }
  78   1      
  79   1              return joyStatus;
  80   1      }
  81          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    160    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
